#!/usr/bin/env ruby

require 'rubygems'
require 'thor'
require 'dotenv'
require 'rscout'
require 'mail'

Dotenv.load

class RscoutCommand < Thor
  desc 'test', 'Run tests'
  method_option :suite, required: :true, type: :string, aliases: [:s], desc: 'The name of the test suite to run.'
  method_option :env, required: :true, type: :string, aliases: [:e], desc: 'The environment to run the test suite on.'
  method_option :verbose, type: :boolean, aliases: [:v], default: false, lazy_default: true, desc: 'Show verbose messaging.'
  def test
    Mail.defaults do
      delivery_method :smtp, address: ENV['SMTP_HOST'], port: ENV['SMTP_PORT']
    end

    RScout.load suites: [ENV['RSCOUT_CONFIG_DIR'], '/suites.yml'].join,
                envs: [ENV['RSCOUT_CONFIG_DIR'], '/environments.yml'].join

    RScout.run suites: [options.suite], envs: [options.env], verbose: options.verbose
  end
end

RscoutCommand.start